Include modsecurity.conf

Include /usr/local/owasp-modsecurity-crs/crs-setup.conf
Include /usr/local/owasp-modsecurity-crs/rules/*.conf

SecRule REQUEST_METHOD "^(TRACE|TRACK)$" \
    "id:1000,phase:1,deny,status:405,log,msg:'TRACE or TRACK method not allowed'"

SecRule REQUEST_HEADERS:User-Agent "nikto|sqlmap|w3af|acunetix|havij" \
    "id:1001,phase:1,deny,status:403,log,msg:'Malicious User-Agent detected'"

SecRule REQUEST_HEADERS:Host "@rx ^[\d.:]+$" \
    "id:10050,phase:1,pass,nolog,ctl:ruleRemoveById=920350"

SecRule IP:REQ_RATE "@gt 100" \
    "id:1002,phase:1,pass,log,msg:'Rate limit exceeded',setvar:ip.req_rate=+1,expirevar:ip.req_rate=60"

SecRule REQUEST_FILENAME "@streq /api/" \
    "id:1003,phase:1,t:none,pass,nolog,ctl:ruleEngine=On"

SecRule REQUEST_FILENAME "@contains /wss" \
    "id:1004,phase:1,t:none,pass,nolog,ctl:ruleEngine=DetectionOnly"

SecRule REQUEST_FILENAME "@contains /ws" \
    "id:1005,phase:1,t:none,pass,nolog,ctl:ruleEngine=DetectionOnly"

SecRule REQUEST_URI "@beginsWith /api/auth/oauth/google/callback" \
    "id:10010,phase:1,pass,nolog,ctl:ruleRemoveById=930120"

SecRule REQUEST_URI "@beginsWith /api/auth/oauth/google/callback" \
    "id:10011,phase:2,pass,nolog,ctl:ruleRemoveTargetById=930120;ARGS:scope"

SecRule REQUEST_URI "@beginsWith /api/social/" \
    "id:1012,phase:1,nolog,pass,ctl:ruleRemoveById=949110,ctl:ruleRemoveById=920350"

SecRule REQUEST_URI "@beginsWith /api/pong/" \
    "id:1013,phase:1,nolog,pass,ctl:ruleRemoveById=949110,ctl:ruleRemoveById=920350"

SecRule REQUEST_URI "@streq /api/auth/gdpr/account" \
    "id:10020,phase:1,pass,nolog,ctl:ruleEngine=Off"

SecRule REQUEST_URI "@streq /api/pong/tournament" \
    "id:10021,phase:1,pass,nolog,ctl:ruleEngine=Off"

SecRule REQUEST_URI "@streq /api/social/friends" \
    "id:10022,phase:1,pass,nolog,ctl:ruleEngine=Off"
